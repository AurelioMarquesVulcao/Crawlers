version: "2.4"
services:
  web:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: "node server.js"
    ports:
      - ${API_PORT}:3300
    restart: always
  #  mongodb:
  #    image: mongo
  #    ports:
  #      - ${MONGO_PORT}:27017
  #    restart: always
  #    environment:
  #     - MONGO_DATA_DIR=/data/db
  #      - MONGO_LOG_DIR=/dev/null
  #      - MONGO_INITDB_ROOT_USERNAME=${MONGO_ROOT_USERNAME}
  #      - MONGO_INITDB_ROOT_PASSWORD=${MONGO_ROOT_PASSWORD}
  # rabbitmq:
  #   image: rabbitmq:3.8.0-management
  #   hostname: crawlers-rabbitmq
  #   ports:
  #     - 1${RABBITMQ_PORT}:15672
  #     - ${RABBITMQ_PORT}:5672
  #   expose:
  #     - 1${RABBITMQ_PORT}
  #   restart: always
  #   environment:
  #     - RABBITMQ_DEFAULT_USER=${RABBITMQ_USERNAME}
  #     - RABBITMQ_DEFAULT_PASS=${RABBITMQ_PASSWORD}
  nginx:
    image: nginx:1.17.3
    ports:
      - ${NGINX_PORT}:80
    volumes:
      - ./app:/usr/share/nginx/html:ro
    restart: always
  enfileirador:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: node workers/enfileirador.js
 
  # worker-tjsc-oab:
  #   extends:
  #     file: common-services.yml
  #     service: base_node
  #   command: node workers/TJSC/extracaoNovos.js

  # worker-tjsc-processo:
  #   extends:
  #     file: common-services.yml
  #     service: base_node
  #   command: node workers/TJSC/extracaoProcesso.js

  # worker-tjmg-oab:
  #   extends:
  #     file: common-services.yml
  #     service: base_node
  #   command: node workers/TJMG/extracaoNovos.js

  # cadastro-consulta:
  #   extends:
  #     file: common-services.yml
  #     service: base_node
  #   command: node workers/consumer_cadastro_consulta.js

  # novos-processos-jte-sp-2:
  #   extends:
  #     file: common-services.yml
  #     service: base_node
  #   command: node workers/JTE/criaFilaNovos_SP_2
  #   restart: always
  #   logging:
  #     driver: "json-file"
  #     options:
  #       max-size: "5m"
  #       max-file: "2"
  
  # novos-processos-jte-sp-15:
  #   extends:
  #     file: common-services.yml
  #     service: base_node
  #   command: node workers/JTE/criaFilaNovos_SP_15
  #   restart: always
  #   logging:
  #     driver: "json-file"
  #     options:
  #       max-size: "5m"
  #       max-file: "2"
      
  
  
  worker-tjba-portal:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    mem_limit: 1000M
    mem_reservation: 1000M
    command: pm2 start workers/TJBAPortal/processDocker01.yml --no-daemon
    

  worker-tjsp-oab:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: node workers/TJSP/extracao.js

  comarcas-tjsp:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: node workers/TJSP/extracaoComarcas.js

  comarcas-tjrs:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: node workers/TJRS/extracaoComarcas.js

  worker-tjsp-processo:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: node workers/TJSP/extracaoProcesso.js

  worker-tjsp-peticao:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: node workers/TJSP/extracaoPeticao.js

  # worker-tjsc-oab:
  #   extends:
  #     file: common-services.yml
  #     service: base_node
  #   command: node workers/TJSC/extracaoNovos.js

  # worker-tjsc-processo:
  #   extends:
  #     file: common-services.yml
  #     service: base_node
  #   command: node workers/TJSC/extracaoProcesso.js

  tjrs-oab:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: node workers/TJRS/extracaoOab.js

  tjrs-processos-novos:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: node workers/TJRS/processosNovos.js

  tjrs-processo-atualizacao:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: node workers/TJRS/processosAtualizacao.js

  tjrs-processos-reprocessamento:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: node workers/TJRS/processosReprocessamento.js

  tjrs-peticao:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: node workers/TJRS/extracaoPeticao.js\

  novos-processos-jte-1:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: pm2 start workers/JTE/criadoresFila/3.0_criaFila01.js --no-daemon
    logging:
      driver: "json-file"
      options:
        max-size: "5m"
        max-file: "2"

  novos-processos-jte-2:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: pm2 start workers/JTE/criadoresFila/3.0_criaFila02.js --no-daemon
    logging:
      driver: "json-file"
      options:
        max-size: "5m"
        max-file: "2"

  novos-processos-jte-3:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: pm2 start workers/JTE/criadoresFila/3.0_criaFila03.js --no-daemon
    logging:
      driver: "json-file"
      options:
        max-size: "5m"
        max-file: "2"

  novos-processos-jte-4:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: pm2 start workers/JTE/criadoresFila/3.0_criaFila04.js --no-daemon
    logging:
      driver: "json-file"
      options:
        max-size: "5m"
        max-file: "2"

  # novos-processos-trt-1:
  #   extends:
  #     file: common-services.yml
  #     service: base_node
  #   command: pm2 start workers/PJE/criaFilaTRT_PJE.js --no-daemon
  #   logging:
  #     driver: "json-file"
  #     options:
  #       max-size: "5m"
  #       max-file: "2"

  novos-processos-trt-2:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: pm2 start workers/PJE/criaFilaTRT_PJE.js --no-daemon
    logging:
      driver: "json-file"
      options:
        max-size: "5m"
        max-file: "2"

  worker-jte-doc-links-01:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: pm2 start workers/JTE_DOC/downloadDoc.yml --no-daemon
    logging:
      driver: "json-file"
      options:
        max-size: "5m"
        max-file: "2"       
        
  # novos-processos-jte-all:
  #   extends:
  #     file: common-services.yml
  #     service: base_node
  #   command: pm2 start workers/JTE/criaFilaNovosTodosEstados.js --no-daemon
  #   restart: always
  #   logging:
  #     driver: "json-file"
  #     options:
  #       max-size: "5m"
  #       max-file: "2"

  worker-jte-01:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      shm_size: '2gb'
      dockerfile: dockerfile-puppeteer
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE/processDocker01.yml --no-daemon
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

  worker-jte-02:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      shm_size: '2gb'
      dockerfile: dockerfile-puppeteer
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE/processDocker02.yml --no-daemon 
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

  worker-jte-03:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      shm_size: '2gb'
      dockerfile: dockerfile-puppeteer
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE/processDocker03.yml --no-daemon
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

  worker-jte-04:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-puppeteer
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE/processDocker04.yml --no-daemon 
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

  worker-jte-05:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-puppeteer
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE/reprocessamento.yml --no-daemon 
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"


  worker-trt-02:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: pm2 start workers/PJE/processDocker01.yml --no-daemon 
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

  verifica-novos:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: pm2 start workers/JTEMonitoria/verificaUltimoProcesso.js --no-daemon 
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

  verifica-sequencial:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: pm2 start workers/JTEMonitoria/workerCnjSequencial.js --no-daemon 
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

  monitoria-jte-1:
    extends:
      file: common-services.yml
      service: base_node
    build:
      context: ./
      dockerfile: dockerfile-node
    command: pm2 start workers/JTEMonitoria/comcarcas7dias.js --no-daemon 
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

  limpa-core:
    extends:
      file: common-services.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    restart: always
    command: pm2 start controller/limpaCoreDocker.js --no-daemon 
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

  worker-jte-doc01:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 01
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

  worker-jte-doc02:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 02
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  
  worker-jte-doc03:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 03
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

  worker-jte-doc04:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 04
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

  worker-jte-doc05:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 05
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc06:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 06
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc07:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 07
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc08:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 08
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc09:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 09
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc10:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 10
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc11:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 11
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc12:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 12
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc13:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 13
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc14:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 14
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc15:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 15
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc16:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 16
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc17:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 17
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc18:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 18
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc19:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 19
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc21:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 21
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc20:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 20
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc22:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 22
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc23:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 23
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"
  worker-jte-doc24:
    extends:
      file: common-servicesDoc.yml
      service: base_node
    build:
      dockerfile: Dockerfile
    mem_limit: ${PUPPETEER_MEMORIA_MAX}
    mem_reservation: ${PUPPETEER_MEMORIA_MIN}
    command: pm2 start workers/JTE_DOC/Worker/extracao_JTE_5doc.js --no-daemon -- 24
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

